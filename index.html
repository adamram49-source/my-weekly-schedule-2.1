<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> 砖转 砖注</title>

<link rel="manifest" href="manifest.json">

<style>
body {
  font-family: system-ui;
  direction: rtl;
  background: #eef2ff;
  margin: 0;
  padding: 10px;
}
h1 { text-align: center; }

.week {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
}

.day {
  background: white;
  border-radius: 12px;
  padding: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,.1);
}

.day-title {
  font-weight: bold;
}

.day-date {
  font-size: 13px;
  color: #555;
  margin-bottom: 6px;
}

.task {
  background: #e5e7eb;
  border-radius: 8px;
  padding: 6px;
  margin-bottom: 6px;
}

.task.past { background: #c7d2fe; }
.task.done { background: #bbf7d0; }

button {
  font-size: 12px;
  margin: 2px;
}

.add {
  width: 100%;
}

.toggle {
  text-align: center;
  margin: 15px;
}
</style>
</head>

<body>

<h1>  砖转</h1>

<div class="week" id="week"></div>

<div class="toggle">
 转专转:
<button id="notifyBtn" onclick="toggleNotify()"></button>
</div>

<script>
/* Service Worker */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

/* 转 */
const daysNames = ["专砖","砖","砖砖","专注","砖","砖砖","砖转"];
let notify = JSON.parse(localStorage.getItem("notifyEnabled")) || false;
document.getElementById("notifyBtn").innerText = notify ? "驻注" : "";

/* helpers */
function load() {
  return JSON.parse(localStorage.getItem("tasks") || "[]");
}
function save(tasks) {
  localStorage.setItem("tasks", JSON.stringify(tasks));
  render();
  scheduleAllNotifications();
}

/* 转专转 */
function toggleNotify() {
  notify = !notify;
  localStorage.setItem("notifyEnabled", JSON.stringify(notify));
  Notification.requestPermission();
  document.getElementById("notifyBtn").innerText = notify ? "驻注" : "";
  scheduleAllNotifications();
}

/* 砖注  */
function getWeek() {
  const arr = [];
  const d = new Date();
  d.setDate(d.getDate() - d.getDay());
  for (let i = 0; i < 7; i++) {
    const x = new Date(d);
    x.setDate(d.getDate() + i);
    arr.push(x);
  }
  return arr;
}

/* 专专 */
function render() {
  const week = document.getElementById("week");
  week.innerHTML = "";
  const tasks = load();
  const now = new Date();

  getWeek().forEach(date => {
    const key = date.toISOString().split("T")[0];
    const box = document.createElement("div");
    box.className = "day";

    box.innerHTML = `
      <div class="day-title">${daysNames[date.getDay()]}</div>
      <div class="day-date">${date.toLocaleDateString("he-IL")}</div>
    `;

    tasks.filter(t => t.date === key).forEach(t => {
      const taskTime = new Date(`${t.date}T${t.time}`);
      const div = document.createElement("div");
      div.className = "task";
      if (t.done) div.classList.add("done");
      else if (taskT
